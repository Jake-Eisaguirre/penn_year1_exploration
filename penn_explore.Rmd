---
title: "Year 1 Pennsylvania Data Exploration"
author: "Jake Eisaguirre"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    numer_sections: true
    code_folding: hide
    theme: united
    highlight: textmate
---

```{r setup, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F)

if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}

librarian::shelf(here, tidyverse, janitor, scales, viridis, ggpubr, kableExtra, broom, stringr)
```

$~$

# Visual Encounter Surveys

### Load and Wrangle VES Data

$~$

#### Load data

```{r, message=FALSE}

ves <- read_csv(here("data", "ves.csv")) %>% 
  clean_names()

```

$~$

#### VES wrangling

```{r, message = FALSE}

visual <- ves %>% 
  group_by(site, species_ves) %>% 
  summarise(count = sum(count),
            species_ves = species_ves) %>% 
  mutate(repeat_id = cur_group_id()) %>% 
  filter(!duplicated(repeat_id)) %>% 
  select(!repeat_id)

visual$scaled_count<- ((visual$count/ sum(visual$count))*100) %>% 
  round(digits = 2)

```


$~$

### Visualize All VES Data

```{r, class.source = "fold-show", message=FALSE}

ggplot(data = visual, aes(fill = species_ves, x = fct_infreq(species_ves), y = scaled_count)) +
  geom_col() +
  geom_text(aes(label = scaled_count), vjust = -0.5, size = 3) +
  theme_classic()+
  facet_grid(~site) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,60)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "All Sites",
       subtitle = "n=282 counts") +
  annotate("segment",x=Inf,xend=-Inf,y=Inf,yend=Inf,color="black",lwd=0.5)

```
 
 $~$
 
#### VES wrangling - 2 sites Repeated

```{r, message=FALSE}

ves_repeat_survs <- ves %>% 
  group_by(site, date, species_ves) %>% 
  summarise(count = sum(count),
            species_ves = species_ves) %>% 
  mutate(repeat_id = cur_group_id()) %>% 
  filter(!duplicated(repeat_id),
         site %in% c("tuttle pond", "wood lab pond")) %>% 
  select(!repeat_id) %>% 
  mutate(site = as.factor(site),
         date = as.factor(date),
         species_ves = as.factor(species_ves))
```

$~$

#### Tuttle Pond and Wood Lab Pond wrangling

```{r, message=FALSE}

tuttle <- ves_repeat_survs %>% 
  filter(site == "tuttle pond")

tuttle$scaled_count<- ((tuttle$count/ sum(tuttle$count))*100)


wood <- ves_repeat_survs %>% 
  filter(site == "wood lab pond")

wood$scaled_count<- ((wood$count/ sum(wood$count))*100)

```


$~$

### Visualize Tuttle Pond

```{r, class.source = "fold-show", message=FALSE}
ggplot(data = tuttle, aes(fill = species_ves, x = fct_infreq(species_ves), y = scaled_count)) +
  geom_col() +
  geom_text(aes(label = scaled_count), vjust = -0.5, size = 3) +
  theme_classic()+
  facet_wrap(~date) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,60)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "Tuttle Pond",
       subtitle = "n=100 counts") +
  annotate("segment",x=Inf,xend=-Inf,y=Inf,yend=Inf,color="black",lwd=0.5)



```

$~$

### Analyse Tuttle Pond

$~$

#### VES Analysis DF

```{r, message=FALSE}
ves_analsys_tuttle <- ves %>% 
  select(c(site, date, species_ves, count)) %>% 
  filter(site == "tuttle pond") %>% 
  mutate(site = as.factor(site),
         date = as.factor(date),
         species_ves = as.factor(species_ves))

ves_analsys_tuttle$scaled_count<- ((ves_analsys_tuttle$count/ sum(ves_analsys_tuttle$count))*100)

```


$~$

#### One way ANOVA explaining count from date of survey at Tuttle Pond

$~$

###### H0: There is no difference in the counts of all frogs between the dates surveyed at Tuttle Pond

###### HA: There is a difference in the counts of all frogs between the dates surveyed at Tuttle Pond

```{r, class.source = "fold-show", message=FALSE}
one_way_date <- aov(scaled_count ~ date, data = ves_analsys_tuttle)

tidy(one_way_date) %>% 
  kable(digits = 2) %>% 
  kable_styling()
```

$~$

#### One way ANOVA explaining count from species at Tuttle Pond

$~$

###### H0: There is no difference in the counts of all frogs between species at Tuttle Pond

###### HA: There is a difference in the counts of all frogs between species at Tuttle Pond

```{r, class.source = "fold-show", message=FALSE}
one_way_species <- aov(scaled_count ~ species_ves, data = ves_analsys_tuttle)

tidy(one_way_species) %>% 
  kable(digits = 2) %>% 
  kable_styling()
```

$~$

#### Two way ANOVA explaining count from species + date of survey at Tuttle Pond

$~$

###### H0: There is no difference in counts of all frogs between the dates surveyed and species at Tuttle Pond

###### HA: There is a difference in counts of all frogs between the dates surveyed and species at Tuttle Pond

```{r, class.source = "fold-show", message=FALSE}
two_way_species_date <- aov(scaled_count ~ date + species_ves, data = ves_analsys_tuttle)

tidy(two_way_species_date) %>% 
  kable(digits = 2) %>% 
  kable_styling()

```

$~$

### Visualize Wood Pond

$~$

#### Sample size too small for analysis

```{r, class.source = "fold-show", message=FALSE}

ggplot(data = wood, aes(fill = species_ves, x = fct_infreq(species_ves), y = scaled_count)) +
  geom_col() +
  geom_text(aes(label = round(scaled_count, 1)), vjust = -0.1, size = 3) +
  theme_classic()+
  facet_wrap(~date) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,50)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "Wood Lab Pond",
       subtitle = "n=11 counts") +
  annotate("segment",x=Inf,xend=-Inf,y=Inf,yend=Inf,color="black",lwd=0.5)

```

$~$

### Visualize Species Occurrance

#### Species Occurance Wranglin
```{r, message = F, warning=F}
combined_site <- ves_repeat_survs %>% 
  group_by(site, species_ves) %>% 
  summarize(count = sum(count))

combined_site$scaled_count<- ((combined_site$count/ sum(combined_site$count))*100)


combine_analysis <- ves %>% 
  select(site, date, species_ves, count)

combine_analysis$scaled_count<- ((combine_analysis$count/ sum(combine_analysis$count))*100)
```


$~$

#### Plot for species occurances per site

```{r, class.source = "fold-show", message=FALSE, warning=F}

ggplot(data = combined_site, aes(x = fct_infreq(species_ves), y = scaled_count, fill = species_ves)) +
  geom_col() +
  geom_text(aes(label = round(scaled_count, 1)), vjust = -0.1, size = 3)+
  facet_wrap(~site) +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,55)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "Repeat Sites",
       subtitle = "Tuttle n=3 dates & Wood n=2 dates") +
  annotate("segment",x=Inf,xend=-Inf,y=Inf,yend=Inf,color="black",lwd=0.5)

```

$~$

#### Plot for species of combined repeated sites

```{r, class.source = "fold-show", message=FALSE, warning=F}

ggplot(data = combined_site, aes(x = fct_infreq(species_ves), y = scaled_count, fill = species_ves)) +
  geom_col() +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,45)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "VES Repeat Sites Combined",
       subtitle = "R. catesbeiana n=63, R. clamitans n=46, R. pipiens n=4") +
  annotate("segment",x=Inf,xend=-Inf,y=Inf,yend=Inf,color="black",lwd=0.5)

```

$~$

### Analyse Sites

$~$

#### One way anova explaining count based on site between Tuttle Pond and Woods Lab Pond

$~$

###### H0: There is no difference in species count between sites

###### HA: There is a difference in species count between sites

```{r, class.source = "fold-show", message=FALSE}
one_way_site <- aov(scaled_count ~ site, data = combine_analysis)
tidy(one_way_site) %>% 
  kable(digits = 4) %>% 
  kable_styling()
```

$~$

#### Two way anova explaining count based on site + species between Tuttle Pond and Woods Lab Pond

$~$

###### H0: There is no difference in species count between sites and species present

###### HA: There is a difference in species count between sites and species present

```{r, class.source = "fold-show", message=FALSE}

two_way_site_species <- aov(scaled_count ~ site + species_ves, data = combine_analysis)
tidy(two_way_site_species) %>% 
  kable(digits = 4) %>% 
  kable_styling()

```

$~$

# Capture & Visual Encounter Surveys

$~$

### Load and Wrangle Capture Data

$~$

#### Load data

```{r, message=FALSE}

cap <- read_csv(here("data", "cap.csv")) %>% 
  clean_names()

```

$~$

#### Wrangle Capture data and join with VES data

```{r, message=FALSE}

capture <- cap %>% 
  mutate(count = 1) %>% 
  group_by(site, species_capture) %>% 
  summarise(count = sum(count),
            species_capture = species_capture) %>% 
  mutate(repeat_id = cur_group_id(),
         species_capture = str_replace(species_capture, "possibly", ""),
         species_capture = str_replace(species_capture, "[[:punct:]]", "")) %>% 
  filter(!duplicated(repeat_id)) %>% 
  filter(!species_capture == "negative control") %>% 
  select(!repeat_id) %>% 
  rename(capture_count = count)

capture$capture_scaled_count<- ((capture$capture_count/ sum(capture$capture_count))*100) %>% 
  round(digits = 2)

visual_join <- visual %>% 
  rename(visual_count = count,
         visual_scaled_count = scaled_count)

comb_data <- merge(capture, visual_join, by.x = c("site", "species_capture"), by.y = c("site", "species_ves")) %>% 
  rename(species = species_capture) %>% 
  select(!c(capture_count, visual_count)) %>% 
  pivot_longer(!c(site, species), names_to = "capture_ves", values_to = "scaled_count") 


```

$~$

### Visualize All Capture Data
```{r, class.source = "fold-show", message=FALSE, warning=F}

ggplot(data = capture, aes(x = fct_infreq(species_capture), y = capture_scaled_count, fill = species_capture)) +
  geom_col() +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5),
        strip.background = element_blank(),
        legend.position = "none") +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,30)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "All Capture Data") 
         


```


$~$

### Visualize Capture and VES Data for Matching Sites and Species
```{r, class.source = "fold-show", message=FALSE}

ggplot(data = comb_data, aes(x = fct_infreq(species), y = scaled_count, fill = capture_ves)) +
  geom_col(stat = "identity", position = position_dodge()) +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5),
        strip.background = element_blank()) +
  scale_fill_viridis_d(name = "Species") +
  scale_y_continuous(expand = c(0,0), limits = c(0,35)) +
  ylab("Percent Occurrence") +
  xlab("Species") +
  labs(title = "Capture and VES Species Counts With Matching Sites and Species",
       subtitle = "")


```

